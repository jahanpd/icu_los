# Predicting ICU Length of Stay
A collaborative study between Australian and Brazilian researchers.

## Aims
This database aims to expose a high level API and define standards to build a dataset and train a stacking regression model.

## Data Preparation
We first prepare a dataset for use in our analysis.

## Defining Columns
We are using tabular data with column names defined by a data dictionary (https://docs.google.com/spreadsheets/d/18y0nari7-tzg5Mn8nr6YPl6f4oC7GSGE/edit?usp=sharing&ouid=111754637778063147718&rtpof=true&sd=true).

The data dictionary is a spreadsheet. 
The sheet labelled data_dict is downloaded as a csv and used in 'preparation/clean.py' to map ANZICS data to the standardised form.
The sheet labelled mapping shows the possible mutual set of variables available in the Brazilian and ANZICS datasets.

## Feature Selection
We do not perform a full feature selection process in our analysis.
Instead we define a set of possible mutual variables between the Brazilian and ANZICS data.
We create a strict subset, where mutual input data columns are defined the same. 
We also create an extended subset, where mutual input data columns are strictly the same AND roughly the same.

## Embedding-Encoding Admission Diagnoses
Admission diagnosis is an important variable but tricky to capture using a categorical variable.
There are around 650 diagnostic codes, and many are quite similar in scope.
An alternative approach to dummification of this variable, that retains as much information as possible, is an embedding-encoding strategy. 
This is a three step approach where we:
1. Embed the natural language diagnosis in to large vector space using a pretrained language model, and
2. Train a neural net autoencoder to map the large vector to an 8 dimensional space, then
3. Perform the mapping and add those 8 new admission diagnosis columns to our dataset

In our sensitivity analysis, this approach has superior results, compared to traditional categorical approaches.

## Environmental Variables

IN_DATA="/absolute/path/to/your/unprocessed/icu/los/dataset"
OUT_DIR="/absolute/path/to/a/working/directory/to/save/results/and/temp/files/to"
VOYAGE_KEY="api-key-for-embedding-model-if-needing-to-do-further-embedding"
DATA_DICT="/absolute/path/to/data_dict.csv"
DIAG_MAP="/absolute/path/to/diagnosis_groupings.csv"

## Notebooks
An example notebook, example.ipynb, shows a possible usage of our high level api.

## Disclaimer
These models are intended for research purposes only. It is not approved for clinical use and must not be used to guide or influence medical decision-making in any capacity. Predictions generated by this model are not a substitute for professional medical judgment. Use of this tool is at the userâ€™s own risk, and no liability is accepted for any outcomes resulting from its use.
